<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Animations API Demo</title>
  <style>
    :root { --size: 80px; --pad: 16px; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0f172a; color: #e2e8f0; }
    header { padding: 24px; text-align: center; }
    header h1 { margin: 0 0 4px; font-size: 1.4rem; }
    header p { margin: 0; opacity: .8; }

    .app { max-width: 920px; margin: 0 auto; padding: 0 24px 40px; display: grid; gap: 20px; }

    .stage-wrapper { display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
    @media (max-width: 860px){ .stage-wrapper{ grid-template-columns: 1fr; } }

    .stage {
      position: relative; height: 340px; border-radius: 20px; padding: var(--pad);
      background: radial-gradient( 1200px 400px at 0% 0%, #1f2937 0%, #0b1220 60%);
      outline: 1px solid rgba(148,163,184,.15);
      box-shadow: 0 20px 40px rgba(2,6,23,.5) inset, 0 10px 24px rgba(2,6,23,.6);
      overflow: hidden;
    }
    .grid { position: absolute; inset: var(--pad); background-size: 40px 40px; background-image: linear-gradient(to right, rgba(148,163,184,.08) 1px, transparent 1px), linear-gradient(to bottom, rgba(148,163,184,.08) 1px, transparent 1px); border-radius: 12px; }

    .box {
      position: absolute; width: var(--size); height: var(--size);
      background: linear-gradient(130deg, #38bdf8, #818cf8 60%, #22d3ee);
      border-radius: 22px; left: var(--pad); top: var(--pad);
      display: grid; place-items: center;
      color: #0b1220; font-weight: 700; text-shadow: 0 1px 0 rgba(255,255,255,.4);
      box-shadow: 0 16px 40px rgba(56,189,248,.25), 0 4px 10px rgba(56,189,248,.3);
    }

    .dot { position: absolute; left: calc(100% - 20px); top: 50%; transform: translate(-50%, -50%); width: 14px; height: 14px; border-radius: 50%; background: #0b1220; opacity: .2; }

    .panel { border-radius: 16px; background: #0b1220; border: 1px solid rgba(148,163,184,.12); padding: 16px; display: grid; gap: 12px; }
    .row { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px; }
    .controls { display: flex; flex-wrap: wrap; gap: 8px; }
    button, input[type="range"], select {
      appearance: none; border: 1px solid rgba(148,163,184,.25); background: #0f172a; color: #e2e8f0;
      padding: 10px 14px; border-radius: 12px; font: inherit; cursor: pointer;
    }
    button:hover{ background: #111a2e; }
    button:disabled{ opacity: .5; cursor: not-allowed; }
    input[type="range"]{ width: 100%; height: 4px; padding: 12px; cursor: ew-resize; }

    code { background: rgba(148,163,184,.12); padding: 2px 6px; border-radius: 8px; }
    footer { text-align: center; opacity: .6; padding: 10px; font-size: .9rem; }
  </style>
</head>
<body>
  <header>
    <h1>Web Animations API (<code>element.animate()</code>)</h1>
    <p>Play, pause, reverse, seek, and change speed ‚Äî all in vanilla JS.</p>
  </header>

  <main class="app">
    <section class="stage-wrapper">
      <div class="stage" id="stage">
        <div class="grid"></div>
        <div class="box" id="box">WAAPI<div class="dot"></div></div>
      </div>

      <aside class="panel" aria-label="Animation controls">
        <div class="row"><strong>Status</strong><span id="status">ready</span></div>

        <div class="row">
          <label for="easing">Easing</label>
          <select id="easing">
            <option value="ease-in-out">ease-in-out</option>
            <option value="linear">linear</option>
            <option value="ease-in">ease-in</option>
            <option value="ease-out">ease-out</option>
            <option value="cubic-bezier(0.22, 1, 0.36, 1)">easeOutBack</option>
            <option value="steps(6, end)">steps(6, end)</option>
          </select>
        </div>

        <div class="row">
          <label for="speed">Playback speed (<span id="speedVal">1.0</span>x)</label>
          <input id="speed" type="range" min="0.2" max="3" step="0.1" value="1">
        </div>

        <div class="row">
          <label for="seek">Seek (<span id="seekVal">0%</span>)</label>
          <input id="seek" type="range" min="0" max="100" step="1" value="0">
        </div>

        <div class="controls">
          <button id="play">‚ñ∂Ô∏è Play</button>
          <button id="pause">‚è∏Ô∏è Pause</button>
          <button id="reverse">üîÅ Reverse</button>
          <button id="restart">‚ü≤ Restart</button>
        </div>
        <small>Tip: try different easings to see how timing curves affect motion.</small>
      </aside>
    </section>

    <section class="panel">
      <strong>What is this?</strong>
      <p>
        This demo uses the <em>Web Animations API</em> to animate the blue box along a square path
        with rotation, scale, and border-radius changes. The core is just:
      </p>
      <pre><code>const anim = element.animate(keyframes, { duration: 3000, iterations: Infinity });</code></pre>
    </section>
  </main>

  <footer>Built with ‚ô• using vanilla JS</footer>

  <script>
    // Grab elements
    const box = document.getElementById('box');
    const statusEl = document.getElementById('status');
    const speed = document.getElementById('speed');
    const speedVal = document.getElementById('speedVal');
    const seek = document.getElementById('seek');
    const seekVal = document.getElementById('seekVal');
    const easing = document.getElementById('easing');

    const playBtn = document.getElementById('play');
    const pauseBtn = document.getElementById('pause');
    const reverseBtn = document.getElementById('reverse');
    const restartBtn = document.getElementById('restart');

    // Define keyframes for a square path with extras
    function makeKeyframes(ease) {
      return [
        { transform: 'translate(0, 0) rotate(0deg) scale(1)',   borderRadius: '22px', offset: 0 },
        { transform: 'translate(240px, 0) rotate(90deg) scale(1.15)',  borderRadius: '40px', offset: 0.25 },
        { transform: 'translate(240px, 240px) rotate(180deg) scale(1)', borderRadius: '22px', offset: 0.5 },
        { transform: 'translate(0, 240px) rotate(270deg) scale(0.9)',   borderRadius: '40px', offset: 0.75 },
        { transform: 'translate(0, 0) rotate(360deg) scale(1)',  borderRadius: '22px', offset: 1 }
      ];
    }

    // Create animation
    let anim = box.animate(makeKeyframes('ease-in-out'), {
      duration: 3000,
      iterations: Infinity,
      direction: 'alternate', // yoyo
      easing: 'ease-in-out',
      fill: 'both'
    });

    // Helpers
    const setStatus = () => {
      const playState = anim.playState; // idle | running | paused | finished
      statusEl.textContent = `${playState} @ ${(anim.currentTime/anim.effect.getTiming().duration*100||0).toFixed(0)}%`;
    };

    // Wire controls
    playBtn.addEventListener('click', () => { anim.play(); setStatus(); });
    pauseBtn.addEventListener('click', () => { anim.pause(); setStatus(); });
    reverseBtn.addEventListener('click', () => { anim.reverse(); setStatus(); });
    restartBtn.addEventListener('click', () => { anim.cancel(); anim = box.animate(makeKeyframes(easing.value), { duration: 3000, iterations: Infinity, direction: 'alternate', easing: easing.value, fill: 'both' }); attachOnframe(); setStatus(); });

    // Playback rate
    speed.addEventListener('input', () => {
      const rate = parseFloat(speed.value);
      anim.playbackRate = rate;
      speedVal.textContent = rate.toFixed(1);
      setStatus();
    });

    // Easing change (restarts animation to apply new timing function)
    easing.addEventListener('change', () => {
      restartBtn.click();
    });

    // Seek via currentTime (0-100%)
    seek.addEventListener('input', () => {
      const pct = parseInt(seek.value, 10) / 100;
      const dur = anim.effect.getTiming().duration;
      anim.currentTime = pct * dur;
      seekVal.textContent = `${(pct*100).toFixed(0)}%`;
      setStatus();
    });

    // Update the seek slider continuously using the new onframe API (where supported)
    function attachOnframe(){
      if ('onfinish' in anim) {
        anim.onfinish = () => setStatus();
      }
      if ('onframe' in anim) {
        anim.onframe = () => {
          const dur = anim.effect.getTiming().duration;
          const pct = (anim.currentTime / dur) * 100;
          seek.value = Math.max(0, Math.min(100, pct));
          seekVal.textContent = `${seek.value}%`;
          setStatus();
        };
      } else {
        // Fallback: rAF loop to keep seek slider in sync
        const loop = () => {
          if (anim.playState === 'running') {
            const dur = anim.effect.getTiming().duration;
            const pct = (anim.currentTime / dur) * 100;
            seek.value = Math.max(0, Math.min(100, pct));
            seekVal.textContent = `${seek.value}%`;
            setStatus();
          }
          requestAnimationFrame(loop);
        };
        requestAnimationFrame(loop);
      }
    }

    attachOnframe();
    setStatus();
  </script>
</body>
</html>
